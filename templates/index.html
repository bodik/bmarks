{% extends "base.html" %}

{% block script %}
<script type="text/javascript">
	$(document).ready(function() {
		var dt_links_table_options = {
			'columnDefs': dt_static_options['columnDefs'].concat([
				{'targets': 'col_created', 'render': (data, type, row) => {return data.slice(0,16);}}
			]),
			'paging': true,
			'pageLength': 100,
			'lengthMenu': [[10, 50, 100, 1000, -1], [10, 50, 100, 1000, "All"]],
			'drawCallback': function (settings) {
				this.find('td a.abutton_delete_by_url').on('click', {'confirmation': 'Really delete?'}, action_submit_by_url);
				this.find('td a.abutton_tag_by_url').on('click', {}, action_submit_by_url);
			}
		};
		$('#dt_links_table').DataTable($.extend({}, dt_static_options, dt_links_table_options));
	});
</script>
{% endblock %}

{% block content %}
{% set crop_link = 100 %}

<ul>
	{% for tag in tags %}
		{{ tag }}
	{% endfor %}
</ul>

<table id="dt_links_table" class="table table-condensed table-hover">
	<thead>
		<tr>
			<th class="col_created">created</th>
			<th>link</th>
			<th>tags</th>
			<th class="no-sort">_buttons</th>
		</tr>
	</thead>
	<tbody>
	{% for item in links %}
		<tr>
			<td>{{ item['created'] }}</td>
			<td><a href="{{ item['link'] }}">{{ item['link'][:crop_link] }}{% if item['link']|length > crop_link %}...{% endif %}</a></td>
			<td>
				{% for tag in item['tags'] %}
					<span class="label label-info">{{ tag }} <a class="abutton_tag_by_url" href="#" data-url="{{ url_for('delete_tag_route', link_id=item['id'], tag=tag) }}"><span class="glyphicon glyphicon-remove"</span></a></span>
				{% endfor %}
			</td>
			<td>
				{% if 'read' not in item['tags'] %}
					<a class="btn btn-xs btn-default abutton_tag_by_url" href="#" data-url="{{ url_for('add_tag_route', link_id=item['id'], tag='read') }}">read</a>
				{% else %}
				{% endif %}
				<a class="btn btn-xs btn-default" href="{{ url_for('edit_route', link_id=item['id']) }}"><span class="glyphicon glyphicon-edit"></span></a>
				<a class="btn btn-xs btn-default abutton_delete_by_url" href="#" data-url="{{ url_for('delete_route', link_id=item['id']) }}"><span class="glyphicon glyphicon-trash text-alert"></span></a>
			</td>
		</tr>
	{% endfor %}
	</tbody>
</table>
{% endblock %}
